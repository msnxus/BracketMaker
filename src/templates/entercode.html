<!DOCTYPE html>
<html>
  <head>
    <title>View a Bracket</title>
  </head>
  <body>
    {% include 'header.html' %}
    <h1 align="center">View a Bracket</h1>
    {% include 'entercode_directions.html'%}

    <hr>

    <form action="/entercode/?" method="get">
        <table>
          <tr>
            <td align="right">Code:</td>
            <th><input type="text" name="code" id="code" value="{{code}}" /></th>
          </tr>

          <tr>
            <td align="right">Bracket Name:</td>
            <th><input type="text" name="name" id="name" value="{{name}}" /></th>
          </tr>

          <tr>
            <td align="right">Owner NetId:</td>
            <th><input type="text" name="owner" id="owner" value="{{owner}}" /></th>
          </tr>

          <tr>
          <td></td>
        </tr>
        </table>
      </form>
        {% if error_message != 'None' %}
        <p style = "color: red;">{{ error_message }}</p>
        {% endif %}

    <br>
    <!--generate the codes table--> 
    <div id="resultsDiv"></div>
    <br>
    {% include 'footer.html' %}

    <script src=
    "https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js">
    </script>

 <script>

 "use strict";


 function handleResponse(data) {
   console.log("Data: " + data)
    $("#resultsDiv").html(data);
 }

 function handleError(request) {
   console.log("ERror")
    if (request.statusText !== "abort")
    alert("Error: Failed to fetch data from server");
 }

 let request = null;

 function getResults() {
    let code = $("#code").val();
    let name = $("#name").val();
    let owner = $("#owner").val();

    let encodedCode = encodeURIComponent(code);
    let encodedName = encodeURIComponent(name);
    let encodedOwner = encodeURIComponent(owner);
    
    let url = "/coderesults?code=" + encodedCode;
    url += "&name=" + encodedName
    url += "&owner=" + encodedOwner

    if (request !== null)
        request.abort();


    let requestData = {
        type: "GET",
        url: url,
        success: handleResponse,
        error: handleError
    };
    request = $.ajax(requestData);
 }

 let timer = null;

 function debouncedGetResults() {
    console.log("HERE")
    clearTimeout(timer);
    timer = setTimeout(getResults, 500);
 }

 function setup() {
    $("#code").on("input", debouncedGetResults);
    $("#name").on("input", debouncedGetResults);
    $("#owner").on("input", debouncedGetResults);
    debouncedGetResults();
 }

 $("document").ready(setup);

 </script>
    </body>
</html>
