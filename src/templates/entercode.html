<!DOCTYPE html>
<html>

<head>
   <meta charset="UTF-8">
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
   <title>View a Bracket</title>
   <style>
      /* Black and white theme with gray accents */
      body {
         background-color: #f0f0f0;
         /* Light gray background */
         color: #333;
         /* Dark gray text */
         padding: 2rem;
         /* Overall padding */
         font-family: Arial, sans-serif;
         /* Modern font */
      }

      .header {
         display: flex;
         /* Use flexbox */
         align-items: center;
         /* Vertically center content */
         padding: 1rem;
         /* Padding for spacing */
         background-color: #f0f0f0;
         /* Light gray background */
      }

      .header h1 {
         flex-grow: 1;
         margin: 0;
         /* No margin to keep content aligned */
         font-size: 2.5rem;
         /* Smaller font for compact header */
         text-align: center;
         /* Centered text */
      }

      .center-text {
         text-align: center;
      }

      .footer {
         width: 67%;
         position: fixed;
         bottom: 0px;
      }
   </style>
</head>

<body>
   <div class="header">
      <h1>BracketMaker</h1> <!-- Centered header text -->
   </div>
   <hr>
   <h1 align="center">View a Bracket</h1><br>
   <p> To search for a bracket, please type in any information about the bracket(s) you wish to view.
      The table will automatically update based on this information.</p>
   <p> To view a bracket, please click on the blue code of the bracket you wish to view.
      You will then be automatically redirected to that bracket.
   </p>
   <form action="/entercode/?" method="get">
      <table>
         <tr>
            <td align="right">Code:</td>
            <th><input type="text" name="code" id="code" value="{{code}}" /></th>
         </tr>
         <tr>
            <td></td>
            <td> <input type="submit" value="Search" /></td>
         </tr>
      </table>
   </form>
   {% if error_message != 'None' %}
   <p style="color: red;">{{ error_message }}</p>
   {% endif %}

   <br>
   <!--generate the codes table-->

   <div style="width: max-content;">
      <div id="resultsDiv"></div>
   </div>

   <br>
   <div class="container">
      <div class="footer">
         {% include 'footer.html' %}
      </div>
   </div>


   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js">
   </script>

   <script>

      "use strict";


      function handleResponse(data) {
         $("#resultsDiv").html(data);
      }

      function handleError(request) {
         if (request.statusText !== "abort")
            alert("Error: Failed to fetch data from server");
      }

      let request = null;

      function getResults() {
         let code = $("#code").val();
         console.log(code)
         let encodedCode = encodeURIComponent(code);

         let url = "/coderesults?code=" + encodedCode;

         if (request !== null)
            request.abort();


         let requestData = {
            type: "GET",
            url: url,
            success: handleResponse,
            error: handleError
         };
         request = $.ajax(requestData);
      }

      let timer = null;

      function debouncedGetResults() {
         console.log("HERE")
         clearTimeout(timer);
         timer = setTimeout(getResults, 500);
      }

      function setup() {
         $("#code").on("input", debouncedGetResults);
         debouncedGetResults();
      }

      $("document").ready(setup);

   </script>
</body>

</html>